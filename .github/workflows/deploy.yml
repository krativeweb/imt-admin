- name: Deploy to Server
  run: |
    ssh -o ServerAliveInterval=60 -o ServerAliveCountMax=10 ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_HOST }} << 'EOF'
      cd ${{ secrets.APP_PATH }}

      echo "ðŸ”„ Pulling latest code..."
      git pull origin main

      echo "ðŸ§¹ Cleaning old files..."
      rm -rf node_modules
      rm -rf .next

      echo "ðŸ“¦ Installing dependencies..."
      npm ci --no-audit --no-fund

      echo "ðŸ—ï¸ Building Next.js..."
      npm run build

      echo "ðŸš€ Restarting PM2..."
      pm2 restart imt-admin || pm2 start node_modules/next/dist/bin/next \
        --name imt-admin \
        -i max \
        -- start -p 4051

      pm2 save
    EOF
